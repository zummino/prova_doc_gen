@startuml

skinparam componentStyle rectangle
skinparam wrapWidth 220
skinparam maxMessageSize 120
skinparam shadowing false

' Host machine and main Python process
node "Host Machine" as host {
  node "SpaceMiner Process (Python)" as proc {
    artifact "src/backend/main.py" as mainpy

    ' Embedded desktop window and front-end
    node "PyWebView Window" as webview {
      artifact "gui/index.html" as indexhtml
      node "Front-end JS runtime" as fe {
        artifact "AJAX calls to /init, /select/logs,\n/discover/*, /view/*, /show/*, /filter/*, /open-url" as ajax
      }
      artifact "gui/scatter3D.html\n(generated by server)" as scatterhtml
    }

    ' Flask server hosting the application back-end
    node "Flask Server (WSGI app)" as flask {
      component "server.py\n(Flask app + routes)" as serverpy
      component "app.py\n(init stubs)" as apppy
      component "xes_handler.py\n(XES merge/convert)" as xespy
      component "process_inprogress.py\n(CSV -> progressive states, CSV->XES utility)" as inprogpy

      artifact "merged.xes\n(runtime output)" as mergedxes
      artifact "*.xes\n(converted from CSV)" as xesfiles
    }

    ' Local storage used by the back-end
    node "Local File System" as fs
  }
}

' External JS/CDN dependencies loaded by the front-end
cloud "CDN Providers" as cdn {
  node "unpkg.com\nvis-network" as cdn_vis
  node "cdn.plot.ly\nplotly-2.9.0.min.js" as cdn_plotly
  node "cdn.jsdelivr.net\nbootstrap 5.1.3" as cdn_bootstrap
  node "code.jquery.com\njquery-3.6.0.slim.min.js" as cdn_jquery
}

' Default system browser used for opening external links
node "Default Web Browser" as extbrowser

' Relationships
mainpy -down-> webview : create_window('SpaceMiner', server)
mainpy -down-> flask : passes Flask app instance

' Front-end to back-end communication
fe --> flask : HTTP/JSON (local)\nwebview token auth
indexhtml --> cdn_vis : load JS
indexhtml --> cdn_plotly : load JS
indexhtml --> cdn_bootstrap : load CSS/JS
indexhtml --> cdn_jquery : load JS

' Back-end file I/O
flask --> fs : read/write XES, CSV, HTML\n(merge_xes, csv_to_xes, write_html)
flask --> scatterhtml : write_html() output

' Front-end visualization refresh
fe --> scatterhtml : embed as <object> (reload on demand)

' Open external URLs on the host
fe --> flask : POST /open-url
flask --> extbrowser : webbrowser.open_new_tab(url)

' Notes explaining responsibilities
note right of flask
- Serves index.html and routes:
  /init, /select/logs, /discover/*,
  /view/3Dscatter*, /show/*, /filter/*, /open-url
- Uses pm4py, pandas, plotly, xml.etree
- Uses webview token for simple request auth
- Invokes OS file dialogs via webview.create_file_dialog
end note

note right of fs
- Input: user-selected *.xes, *.csv
- Output: merged.xes, converted *.xes, gui/scatter3D.html
end note
@enduml