@startuml

skinparam backgroundColor white
skinparam shadowing false
skinparam linetype ortho
skinparam defaultTextAlignment left
skinparam ArrowColor #2d3e50
skinparam NodeBorderColor #2d3e50
skinparam ArtifactBorderColor #2d3e50
skinparam ComponentBorderColor #2d3e50

' Host machine and local processes
node "Host machine" as host {
  node "Go binary: gotor server\n(Dark Web OSINT tools/TorBot/gotor)" as gotor <<process>> {
    artifact "HTTP API (gorilla/mux):\n- GET /ip\n- GET /emails?link=...\n- GET /phone?link=...\n- GET /tree?link=...&depth=...\n- GET /content?link=...\nPort: 8081 (cmd/main/main.go)" as gotor_api
  }

  node "Python: torbot CLI\n(Dark Web OSINT tools/TorBot/torbot)" as torbot <<process>> {
    artifact "modules.api base_url = http://{HOST}:{PORT}\n(env HOST, PORT; modules/config.py)" as torbot_api
    artifact "NLP pipeline (sklearn)\n- training_data directory (modules/nlp)\n- auto-generate via gather_data.py" as nlp_data
  }

  node "Python: torcrawl CLI\n(Dark Web OSINT tools/TorCrawl)" as torcrawl <<process>> {
    artifact "Optional TOR routing:\n- socks.setdefaultproxy(..., 127.0.0.1:9050)\n- checker.checktor()" as torcrawl_conf
  }

  node "Flask: Launcher API\n(Laucher/app)" as launcher <<process>> {
    artifact "Endpoints:\n- GET /tools\n- GET /tools/{tool}\n- POST /launch\nUses docker.from_env()" as launcher_ep
    artifact "Config keys:\n- TOOLS_DIRECTORY\n- OUTOUT_DIRECTORY (typo in code)\n(configuration.py)" as launcher_cfg
  }

  node "Flask: Old-Launcher\n(Old-Launcher/launcher)" as oldlauncher <<process>> {
    artifact "Endpoints:\n- GET /tools\n- GET /tools/{tool}\n- POST /launch\nserver.run(host=0.0.0.0, port=5000)" as old_ep
    artifact "Uses docker.from_env(), builds images,\n runs Logstash container,\n uploads to http://host.docker.internal:8080" as old_behavior
  }

  node "Docker Engine" as docker <<runtime>> {
  }

  node "Node.js: OSINT-IG scripts\n(OSINT-IG)" as osintig <<process>> {
    artifact "osint.js:\n- Calls i.instagram.com and www.instagram.com endpoints" as ig_calls
  }
}

' External dependencies
node "SOCKS5 proxy (Tor)" as torproxy <<external>> {
  artifact "Used by gotor when USE_TOR=true\n(SOCKS5_HOST, SOCKS5_PORT via .env)\nUsed by torcrawl (127.0.0.1:9050)" as torproxy_conf
}

node "Target websites (HTTP/HTTPS)" as targets <<external>>
node "check.torproject.org" as torcheck <<external>>

node "Docker Registry" as registry <<external>>
node "Tool container (ephemeral)" as toolctr <<container>> {
  artifact "Entrypoint = feature.replace_input_in_command(inputs)\nVolume: host OUTOUT_DIRECTORY:/output\n(Laucher/app/utils/services/docker_service.py)" as toolctr_conf
}

node "host.docker.internal:8080\n(external receiver used by Old-Launcher upload)" as uploadapi <<external>>

node "Instagram web endpoints\n(i.instagram.com, www.instagram.com)" as instagram <<external>>

' Communication paths (derived from code)
torbot --> gotor : HTTP GET to /ip, /emails, /phone, /tree, /content
gotor --> targets : HTTP(S) crawl (linktree.NewNode, streamTokens)
gotor --> torcheck : GET https://check.torproject.org/ (getTorIP)
gotor -[#gray,dashed]-> torproxy : Optional SOCKS5 proxy (USE_TOR=true)

torcrawl --> targets : urllib requests (crawler/extractor)
torcrawl -[#gray,dashed]-> torproxy : SOCKS5 127.0.0.1:9050 (default)

launcher --> docker : Docker SDK (docker.from_env)
docker --> registry : images.pull(tag)
docker --> toolctr : containers.run(image, entrypoint,\n  volumes=[OUTOUT_DIRECTORY:/output], auto_remove=True)

oldlauncher --> docker : Docker SDK (docker.from_env)\nimages.build/run, logstash container
oldlauncher --> uploadapi : POST /logstash/{tool} (upload_output)

osintig --> instagram : HTTPS requests (userInfo, userFollowing,\n userFollowers, userFeedText, userFeedLocations)

' Notes with explicit configuration sources
note right of gotor
- Reads .env via godotenv (internal/config)
- USE_TOR (default true if not set to "false")
- SOCKS5_HOST, SOCKS5_PORT
- DEBUG -> log level
end note

note right of torbot
- Uses env HOST, PORT (modules/config.py)
- Data dir TORBOT_DATA_DIR (auto-created)
- LOG_LEVEL
end note

note right of launcher
- tools under TOOLS_DIRECTORY
- POST /launch pulls image and runs container
- Volume map: OUTOUT_DIRECTORY:/output
end note

note right of toolctr
- Removed after run (force) by DockerServices
end note

note right of oldlauncher
- Builds images from ./tools
- Runs logstash and uploads output lines
end note

legend right
  = Legend =
  Solid arrow: mandatory runtime call
  Dashed arrow: optional path (Tor SOCKS5)
  External: outside host or logically external
endlegend
@enduml